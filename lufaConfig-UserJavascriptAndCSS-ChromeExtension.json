{"settings":{"aboutOpened":false,"badgeCounter":false,"editor":{"fontSize":15,"keyboardHandler":null,"showInvisibles":false,"tabSize":2,"theme":"ace/theme/dracula","useSoftTabs":false,"useWorker":true,"wrap":"free"},"rulesSortBy":"name","rulesSortDesc":true,"themeBg":"231.42deg 14.89% 18.43%","themeDark":true,"themeText":"60deg 29.99% 96.07%"},"rules":[{"id":"ddcc4b4c-2b2e-494f-8791-cf164324d979","name":"Lufa","urls":"https://montreal.lufa.com/fr/marche*, https://montreal.lufa.com/en/marketplace*","js":"function lufa_filter() {\n\tlet maxScrollInterval = 200; // Maximum amount to scroll on each step\n\tlet scrollDelay = 100; // Delay in milliseconds between each scroll\n\tlet stopRequested = false;\n\tlet foundDiscounts = 0; // Initialize the count of found discounts\n\n\tfunction firstItem() {\n\t\t// Get the first <li> item of the navigation bar with class name \"user-sidebar\"\n\t\tvar firstLiItem = document.querySelector('.user-sidebar li:first-child');\n\n\t\t// Get the link (<a> tag) inside the first <li> item\n\t\tvar link = firstLiItem.querySelector('a');\n\t\tconsole.log(link);\n\t\t// Click the link\n\t\tlink.click();\n\t}\n\n\tfirstItem();\n\n\t// Create and show the overlay with the loading GIF, text, and stop button\n\tlet overlay = $(`\n    <div id=\"lufa-overlay\" style=\"position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;\">\n        <img src=\"//raw.githubusercontent.com/michaelbontyes/lufa/main/loader.gif\" alt=\"Loading\" style=\"width: 200px; height: 200px;\">\n        <div style=\"color: white; font-size: 24px; margin: 20px;\"><span id=\"discount-count\"></span><span class=\"animated-ellipsis\"></span></div>\n        <button id=\"stop-button\" style=\"padding: 10px 20px; font-size: 16px; cursor: pointer;\">Stop</button>\n    </div>\n    `);\n\t$('body').append(overlay);\n\n\t// Add click event listener to the stop button\n\t$('#stop-button').click(function () {\n\t\tstopRequested = true;\n\t\t$('#lufa-overlay').remove();\n\t});\n\n\t// Add CSS animation for the animated ellipsis\n\t$('<style>')\n\t\t.prop('type', 'text/css')\n\t\t.html(\n\t\t\t`\n            @keyframes blink {\n                0%, 100% { opacity: 0; }\n                50% { opacity: 1; }\n            }\n            .animated-ellipsis::after {\n                content: '...';\n                animation: blink 1s infinite;\n            }\n        `\n\t\t)\n\t\t.appendTo('head');\n\n\tfunction scrollStep() {\n\t\tif (stopRequested) return;\n\n\t\tlet scrollTop = $(window).scrollTop();\n\t\tlet scrollHeight = $(document).height();\n\t\tlet newScrollTop = scrollTop + maxScrollInterval;\n\n\t\t$(window).scrollTop(newScrollTop);\n\n\t\t// Filter products without discount at each scroll step\n\t\tfilterProductsWithoutDiscount();\n\n\t\tif (\n\t\t\tscrollTop < scrollHeight - $(window).height() &&\n\t\t\tnewScrollTop < scrollHeight\n\t\t) {\n\t\t\tsetTimeout(scrollStep, scrollDelay);\n\t\t} else {\n\t\t\tconsole.log('Reached the bottom or no more content to load.');\n\t\t\t// Remove the overlay once filtering is complete\n\t\t\t$('#lufa-overlay').remove();\n\t\t\tfirstItem();\n\t\t}\n\t}\n\n\tfunction filterProductsWithoutDiscount() {\n\t\t$('.single-product-wrapper, .products-wrapper-generated')\n\t\t\t.filter(function () {\n\t\t\t\treturn $(this).find('.discount-tag').length === 0;\n\t\t\t})\n\t\t\t.remove();\n\n\t\t// Update the count of found discounts\n\t\tfoundDiscounts = $('.discount-tag').length;\n\t\t$('#discount-count').text(foundDiscounts + ' aubaines trouvÃ©es');\n\n\t\t// Update the \"Aubaines\" button text with the count\n\t\t$('.header-aubaines').text('Aubaines (' + foundDiscounts + ')');\n\t}\n\n\tscrollStep();\n}\n\nwindow.onload = function () {\n\tconsole.log(\n\t\t'Page is fully loaded. Adding \"Aubaines\" button to navigation...'\n\t);\n\n\t// Find the navigation list\n\tvar navList = document.querySelector('.v2-header-menu .v2-header-wrapper ul');\n\n\tif (navList) {\n\t\t// Create the new list item\n\t\tvar newListItem = document.createElement('li');\n\n\t\t// Create the div container for the button\n\t\tvar newDiv = document.createElement('div');\n\t\tnewDiv.style.display = 'inline-block';\n\t\tnewDiv.style.position = 'relative';\n\n\t\t// Create the button\n\t\tvar newButton = document.createElement('a');\n\t\tnewButton.href = 'javascript:void(0);'; // Prevent default link behavior\n\t\tnewButton.className = 'v2-button-green button-small header-aubaines';\n\t\tnewButton.id = 'header-one-time-basket';\n\t\tnewButton.style.backgroundColor = 'red'; // Set the background color to red\n\t\tnewButton.innerText = 'Aubaines';\n\t\tnewButton.onclick = function () {\n\t\t\tlufa_filter();\n\t\t};\n\n\t\t// Append the button to the div container\n\t\tnewDiv.appendChild(newButton);\n\n\t\t// Append the div container to the list item\n\t\tnewListItem.appendChild(newDiv);\n\n\t\t// Insert the new list item before the last list item in the navigation\n\t\tnavList.insertBefore(newListItem, navList.lastChild);\n\n\t\tconsole.log(\n\t\t\t'\"Aubaines\" button added to navigation. Click to run lufa_filter().'\n\t\t);\n\t} else {\n\t\tconsole.error(\n\t\t\t'Navigation list not found. Unable to add \"Aubaines\" button.'\n\t\t);\n\t}\n};\n","styleAlt":true,"libs":["jQuery 3"],"updatedAt":1708275320194}],"libs":[{"isDefault":true,"name":"jQuery 3","src":"@extension@jquery.min.js"}],"version":10,"sync":{"id":"23e98b13-cf1d-4c17-a455-3f8d208e4d0a","lastEmitterId":"45da0d56-c628-446c-b598-3b61050aa895","updatedAt":1708187183712}}